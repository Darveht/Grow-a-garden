
<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>Garden Dreams - Aventura de Plantas</title>
<style>
  :root{
    --primary: #00B2FF;
    --secondary: #0084C7;
    --success: #00D924;
    --warning: #FFB800;
    --danger: #FF3838;
    --dark: #393B44;
    --darker: #242529;
  }
  
  html,body{
    height:100%;
    margin:0;
    font-family:'Gotham', 'Arial Black', sans-serif;
    overflow:hidden;
    background: linear-gradient(180deg, #00B2FF 0%, #87CEEB 100%);
    user-select:none;
    -webkit-user-select:none;
  }
  
  canvas{
    display:block; 
    width:100%; 
    height:100%; 
    touch-action:none;
  }
  
  /* ===== INTRO √âPICO ===== */
  .epicIntro{
    position:fixed;
    top:0;
    left:0;
    width:100vw;
    height:100vh;
    background: linear-gradient(45deg, #00B2FF 0%, #0084C7 50%, #87CEEB 100%);
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    z-index:2000;
    color:white;
    overflow:hidden;
  }
  
  .droneView{
    position:relative;
    width:100%;
    height:100%;
    overflow:hidden;
  }
  
  .skipButton{
    position:absolute;
    bottom:30px;
    right:30px;
    padding:12px 20px;
    background:rgba(0,0,0,0.5);
    border:2px solid white;
    border-radius:6px;
    color:white;
    font-size:16px;
    font-weight:bold;
    cursor:pointer;
    z-index:20;
  }
  
  .victorySequence{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:white;
    display:none;
    align-items:center;
    justify-content:center;
    flex-direction:column;
    z-index:25;
  }
  
  .skull{
    font-size:60px;
    animation:skullPulse 2s ease-in-out infinite;
  }
  
  @keyframes skullPulse{
    0%, 100% { transform:scale(1); }
    50% { transform:scale(1.2); }
  }
  
  /* ===== PANTALLA DE INICIO ===== */
  .startScreen{
    position:fixed;
    top:0;
    left:0;
    width:100vw;
    height:100vh;
    background: linear-gradient(180deg, #00B2FF 0%, #0084C7 50%, #87CEEB 100%);
    display:none;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    z-index:1000;
    color:white;
  }
  
  .gameTitle{
    font-size:clamp(2rem, 8vw, 4rem);
    font-weight:900;
    text-align:center;
    margin-bottom:2rem;
    color:white;
    text-shadow:0 4px 8px rgba(0,0,0,0.3);
  }
  
  .mainMenu{
    display:flex;
    flex-direction:column;
    gap:15px;
    min-width:280px;
  }
  
  .menuBtn{
    padding:15px 30px;
    background:var(--primary);
    border:none;
    border-radius:6px;
    color:white;
    font-size:18px;
    font-weight:700;
    cursor:pointer;
    transition:all 0.2s ease;
    text-align:center;
  }
  
  .menuBtn:hover{
    background:var(--secondary);
    transform:translateY(-2px);
  }
  
  /* ===== HUD M√ìVIL MINIMALISTA ===== */
  .gameScreen{
    display:none;
    background:transparent;
  }
  .gameScreen.active{display:block}
  
  .mobileHUD{
    position:fixed;
    top:10px;
    left:10px;
    right:10px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    z-index:120;
    pointer-events:none;
  }
  
  .hudLeft{
    display:flex;
    align-items:center;
    gap:10px;
  }
  
  .hudRight{
    display:flex;
    align-items:center;
    gap:10px;
  }
  
  .hudIcon{
    pointer-events:auto;
    width:45px;
    height:45px;
    background:rgba(0,0,0,0.7);
    border:2px solid white;
    border-radius:6px;
    display:flex;
    align-items:center;
    justify-content:center;
    color:white;
    font-size:20px;
    font-weight:bold;
    cursor:pointer;
    transition:all 0.2s ease;
  }
  
  .hudIcon:hover{
    background:var(--primary);
    transform:scale(1.1);
  }
  
  .moneyDisplay{
    pointer-events:auto;
    background:rgba(0,0,0,0.7);
    border:2px solid white;
    border-radius:6px;
    padding:8px 12px;
    color:white;
    font-weight:bold;
    font-size:16px;
  }
  
  /* ===== MEN√ö HAMBURGUESA ===== */
  .hamburgerMenu{
    position:fixed;
    top:0;
    right:-300px;
    width:300px;
    height:100vh;
    background:rgba(0,0,0,0.9);
    border-left:2px solid white;
    z-index:200;
    transition:right 0.3s ease;
    padding:20px;
    color:white;
  }
  
  .hamburgerMenu.open{
    right:0;
  }
  
  .menuHeader{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:30px;
    border-bottom:1px solid rgba(255,255,255,0.3);
    padding-bottom:15px;
  }
  
  .menuItem{
    padding:15px 0;
    border-bottom:1px solid rgba(255,255,255,0.1);
    cursor:pointer;
    font-size:16px;
    font-weight:bold;
    transition:color 0.2s ease;
  }
  
  .menuItem:hover{
    color:var(--primary);
  }
  
  /* ===== CONTROLES M√ìVILES ===== */
  .mobileControls{
    position:fixed;
    bottom:20px;
    left:20px;
    right:20px;
    display:flex;
    justify-content:space-between;
    align-items:end;
    z-index:140;
    pointer-events:none;
  }
  
  .joystick{
    pointer-events:auto;
    width:120px;
    height:120px;
    background:rgba(0,0,0,0.5);
    border:3px solid white;
    border-radius:50%;
    position:relative;
  }
  
  .joystickKnob{
    position:absolute;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    width:50px;
    height:50px;
    background:white;
    border-radius:50%;
    transition:all 0.1s ease;
  }
  
  .actionButtons{
    display:flex;
    flex-direction:column;
    gap:10px;
    pointer-events:auto;
  }
  
  .actionBtn{
    width:60px;
    height:60px;
    background:rgba(0,0,0,0.7);
    border:2px solid white;
    border-radius:50%;
    color:white;
    font-size:24px;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    transition:all 0.2s ease;
  }
  
  .actionBtn:hover{
    background:var(--primary);
    transform:scale(1.1);
  }
  
  /* ===== PANELES M√ìVILES ===== */
  .mobilePanel{
    position:fixed;
    bottom:-100%;
    left:0;
    right:0;
    background:rgba(0,0,0,0.9);
    border-top:2px solid white;
    border-radius:20px 20px 0 0;
    color:white;
    z-index:300;
    transition:bottom 0.3s ease;
    max-height:80vh;
    overflow-y:auto;
  }
  
  .mobilePanel.open{
    bottom:0;
  }
  
  .panelHeader{
    padding:20px;
    border-bottom:1px solid rgba(255,255,255,0.3);
    display:flex;
    justify-content:space-between;
    align-items:center;
  }
  
  .panelContent{
    padding:20px;
  }
  
  .closePanel{
    background:var(--danger);
    border:none;
    color:white;
    padding:8px 12px;
    border-radius:4px;
    cursor:pointer;
  }
  
  /* ===== SISTEMA DE TIEMPO ===== */
  .timeWeatherHUD{
    position:fixed;
    top:70px;
    left:50%;
    transform:translateX(-50%);
    background:rgba(0,0,0,0.7);
    border:2px solid white;
    border-radius:6px;
    padding:8px 15px;
    color:white;
    font-size:14px;
    font-weight:bold;
    z-index:125;
    text-align:center;
    pointer-events:none;
  }
  
  .rainEffect{
    position:fixed;
    top:0;
    left:0;
    width:100vw;
    height:100vh;
    pointer-events:none;
    z-index:50;
  }
  
  /* ===== TOAST NOTIFICACIONES ===== */
  .toast{
    position:fixed;
    left:50%;
    top:50%;
    transform:translate(-50%, -50%);
    background:rgba(0,0,0,0.9);
    color:white;
    padding:15px 25px;
    border-radius:8px;
    display:none;
    z-index:400;
    font-weight:bold;
    border:2px solid white;
    text-align:center;
    max-width:80vw;
  }
  
  /* ===== RESPONSIVE ===== */
  @media (max-width: 768px) {
    .hudIcon { width:40px; height:40px; font-size:18px; }
    .joystick { width:100px; height:100px; }
    .joystickKnob { width:40px; height:40px; }
    .actionBtn { width:50px; height:50px; font-size:20px; }
  }
</style>
</head>
<body>
  <!-- ===== INTRO √âPICO CON PERSONAJE ROBLOX ===== -->
  <div class="epicIntro" id="epicIntro">
    <div class="droneView" id="droneView"></div>
    <button class="skipButton" id="skipIntro">Omitir</button>
    
    <!-- Secuencia de Victoria -->
    <div class="victorySequence" id="victorySequence">
      <div class="skull">üíÄ</div>
    </div>
  </div>

  <!-- ===== PANTALLA DE INICIO ===== -->
  <div class="startScreen" id="startScreen">
    <h1 class="gameTitle">Garden Dreams</h1>
    <div class="mainMenu">
      <button class="menuBtn" id="btnPlay">Jugar</button>
      <button class="menuBtn" id="btnOnline">Multijugador</button>
      <button class="menuBtn" id="btnSettings">Configuraci√≥n</button>
    </div>
  </div>

  <!-- ===== JUEGO ===== -->
  <div class="gameScreen" id="gameScreen">
    <!-- HUD Superior Minimalista -->
    <div class="mobileHUD">
      <div class="hudLeft">
        <div class="hudIcon" id="gameIcon">üéÆ</div>
        <div class="moneyDisplay">üí∞ <span id="money">50</span></div>
      </div>
      <div class="hudRight">
        <div class="hudIcon" id="hamburgerBtn">‚ò∞</div>
      </div>
    </div>

    <!-- Informaci√≥n de Tiempo y Clima -->
    <div class="timeWeatherHUD" id="timeWeatherHUD">
      <div id="timeDisplay">‚òÄÔ∏è D√≠a - 12:00</div>
      <div id="weatherDisplay">‚òÄÔ∏è Soleado</div>
    </div>

    <!-- Men√∫ Hamburguesa -->
    <div class="hamburgerMenu" id="hamburgerMenu">
      <div class="menuHeader">
        <h3>Men√∫</h3>
        <button class="closePanel" id="closeHamburger">‚úï</button>
      </div>
      <div class="menuItem" id="showInventory">üéí Inventario</div>
      <div class="menuItem" id="showStore">üè™ Tienda</div>
      <div class="menuItem" id="showSettings">‚öôÔ∏è Configuraci√≥n</div>
      <div class="menuItem" id="showMap">üó∫Ô∏è Mapa</div>
      <div class="menuItem" id="exitGame">üö™ Salir</div>
    </div>

    <!-- Controles M√≥viles -->
    <div class="mobileControls">
      <div class="joystick" id="joystick">
        <div class="joystickKnob" id="joystickKnob"></div>
      </div>
      
      <div class="actionButtons">
        <div class="actionBtn" id="jumpBtn">‚¨ÜÔ∏è</div>
        <div class="actionBtn" id="interactBtn">üëÜ</div>
      </div>
    </div>

    <!-- Panel M√≥vil Universal -->
    <div class="mobilePanel" id="mobilePanel">
      <div class="panelHeader">
        <h3 id="panelTitle">Panel</h3>
        <button class="closePanel" id="closeMobilePanel">‚úï</button>
      </div>
      <div class="panelContent" id="panelContent">
        <!-- Contenido din√°mico -->
      </div>
    </div>

    <!-- Efecto de Lluvia -->
    <div class="rainEffect" id="rainEffect"></div>
  </div>

  <!-- Toast para Notificaciones -->
  <div class="toast" id="toast"></div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.156.0/build/three.min.js"></script>

  <script>
  // ----- CONFIGURACI√ìN Y ESTADO -----
  let state = { 
    money: 50, 
    farmName: 'Jard√≠n M√°gico', 
    plants: [],
    inventory: { carrot: 3, tomato: 2, corn: 0, lettuce: 1, potato: 0, pepper: 0 },
    gameStarted: false,
    introCompleted: false,
    currentPanel: null
  };

  // ----- SISTEMA DE TIEMPO Y CLIMA -----
  let timeSystem = {
    currentTime: 12,
    weather: 'sunny',
    isRaining: false
  };

  const seedCatalog = [
    {id: 'carrot', name: 'Zanahoria', price: 2, desc: 'Crece r√°pido', growTime: 8000},
    {id: 'tomato', name: 'Tomate', price: 4, desc: 'Jugoso y nutritivo', growTime: 12000},
    {id: 'corn', name: 'Ma√≠z', price: 6, desc: 'Dorado y nutritivo', growTime: 15000},
    {id: 'lettuce', name: 'Lechuga', price: 3, desc: 'Fresca y verde', growTime: 10000},
    {id: 'potato', name: 'Papa', price: 5, desc: 'Vers√°til tub√©rculo', growTime: 14000},
    {id: 'pepper', name: 'Pimiento', price: 7, desc: 'Picante y sabroso', growTime: 16000}
  ];

  // ----- ELEMENTOS DOM -----
  const epicIntro = document.getElementById('epicIntro');
  const startScreen = document.getElementById('startScreen');
  const gameScreen = document.getElementById('gameScreen');
  const droneView = document.getElementById('droneView');
  const victorySequence = document.getElementById('victorySequence');
  const hamburgerMenu = document.getElementById('hamburgerMenu');
  const mobilePanel = document.getElementById('mobilePanel');

  // ----- INTRO √âPICO CON PERSONAJE ROBLOX -----
  let droneScene, droneCamera, droneRenderer;
  let robloxCharacter, animationMixer, victoryAction;
  let droneAnimationId;
  let introPhase = 'drone'; // drone, character, victory

  function createEpicIntro() {
    droneScene = new THREE.Scene();
    droneScene.background = new THREE.Color(0x87CEEB);
    
    droneCamera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
    droneCamera.position.set(0, 25, 30);
    
    droneRenderer = new THREE.WebGLRenderer({antialias: true});
    droneRenderer.setSize(window.innerWidth, window.innerHeight);
    droneRenderer.shadowMap.enabled = true;
    droneRenderer.shadowMap.type = THREE.PCFSoftShadowMap;
    
    droneView.appendChild(droneRenderer.domElement);
    
    // Iluminaci√≥n
    const hemiLight = new THREE.HemisphereLight(0x87CEEB, 0x4CAF50, 0.8);
    droneScene.add(hemiLight);
    
    const dirLight = new THREE.DirectionalLight(0xffffff, 1.2);
    dirLight.position.set(20, 30, 10);
    dirLight.castShadow = true;
    droneScene.add(dirLight);
    
    // Crear mundo del jard√≠n
    createIntroWorld();
    
    // Crear personaje Roblox
    createRobloxCharacter();
    
    // Iniciar animaci√≥n
    startIntroSequence();
  }

  function createIntroWorld() {
    // Suelo
    const ground = new THREE.Mesh(
      new THREE.PlaneGeometry(100, 100),
      new THREE.MeshLambertMaterial({ color: 0x4CAF50 })
    );
    ground.rotation.x = -Math.PI / 2;
    ground.receiveShadow = true;
    droneScene.add(ground);
    
    // Parcelas de cultivo
    for(let x = -20; x <= 20; x += 5) {
      for(let z = -20; z <= 20; z += 5) {
        const plot = new THREE.Mesh(
          new THREE.BoxGeometry(3, 0.2, 3),
          new THREE.MeshLambertMaterial({ color: 0x8B4513 })
        );
        plot.position.set(x, 0.1, z);
        droneScene.add(plot);
      }
    }
    
    // Tienda
    const store = new THREE.Mesh(
      new THREE.BoxGeometry(15, 6, 10),
      new THREE.MeshLambertMaterial({ color: 0x00B2FF })
    );
    store.position.set(0, 3, -25);
    store.castShadow = true;
    droneScene.add(store);
  }

  function createRobloxCharacter() {
    robloxCharacter = new THREE.Group();
    
    // Cuerpo estilo Roblox
    const torso = new THREE.Mesh(
      new THREE.BoxGeometry(4, 6, 2),
      new THREE.MeshLambertMaterial({ color: 0x00B2FF })
    );
    torso.position.y = 3;
    robloxCharacter.add(torso);
    
    // Cabeza
    const head = new THREE.Mesh(
      new THREE.BoxGeometry(4, 4, 4),
      new THREE.MeshLambertMaterial({ color: 0xFFE4B5 })
    );
    head.position.y = 7;
    robloxCharacter.add(head);
    
    // Sombrero rojo
    const hat = new THREE.Mesh(
      new THREE.CylinderGeometry(2.5, 2.5, 1),
      new THREE.MeshLambertMaterial({ color: 0xFF0000 })
    );
    hat.position.y = 9.5;
    robloxCharacter.add(hat);
    
    // Brazos
    const leftArm = new THREE.Mesh(
      new THREE.BoxGeometry(2, 6, 2),
      new THREE.MeshLambertMaterial({ color: 0xFFE4B5 })
    );
    leftArm.position.set(-3, 3, 0);
    robloxCharacter.add(leftArm);
    
    const rightArm = new THREE.Mesh(
      new THREE.BoxGeometry(2, 6, 2),
      new THREE.MeshLambertMaterial({ color: 0xFFE4B5 })
    );
    rightArm.position.set(3, 3, 0);
    robloxCharacter.add(rightArm);
    
    // Piernas
    const leftLeg = new THREE.Mesh(
      new THREE.BoxGeometry(2, 6, 2),
      new THREE.MeshLambertMaterial({ color: 0x00B2FF })
    );
    leftLeg.position.set(-1, -3, 0);
    robloxCharacter.add(leftLeg);
    
    const rightLeg = new THREE.Mesh(
      new THREE.BoxGeometry(2, 6, 2),
      new THREE.MeshLambertMaterial({ color: 0x00B2FF })
    );
    rightLeg.position.set(1, -3, 0);
    robloxCharacter.add(rightLeg);
    
    // Posici√≥n inicial (fuera de vista)
    robloxCharacter.position.set(50, 0, -25);
    robloxCharacter.scale.set(2, 2, 2); // Hacer el personaje gigante
    
    droneScene.add(robloxCharacter);
  }

  function startIntroSequence() {
    const startTime = Date.now();
    let phase = 'drone';
    let characterWalkStarted = false;
    let victoryStarted = false;
    
    function animate() {
      if (state.introCompleted) return;
      
      const elapsed = Date.now() - startTime;
      
      if (phase === 'drone' && elapsed < 10000) {
        // Fase 1: Vista drone por 10 segundos
        const angle = elapsed * 0.0005;
        const radius = 35;
        
        droneCamera.position.x = Math.sin(angle) * radius;
        droneCamera.position.z = Math.cos(angle) * radius;
        droneCamera.position.y = 25 + Math.sin(elapsed * 0.001) * 3;
        droneCamera.lookAt(0, 0, 0);
        
      } else if (phase === 'drone' && elapsed >= 10000) {
        // Cambiar a fase del personaje
        phase = 'character';
        characterWalkStarted = true;
      }
      
      if (phase === 'character') {
        // Fase 2: Personaje caminando hacia la tienda
        if (robloxCharacter.position.x > 5) {
          robloxCharacter.position.x -= 0.3; // Caminar lentamente
          
          // Animaci√≥n de caminar (balanceo simple)
          robloxCharacter.rotation.z = Math.sin(elapsed * 0.005) * 0.1;
          
          // C√°mara sigue al personaje
          droneCamera.position.set(
            robloxCharacter.position.x + 10,
            15,
            robloxCharacter.position.z + 15
          );
          droneCamera.lookAt(robloxCharacter.position);
          
        } else if (!victoryStarted) {
          // Personaje llega a la tienda y levanta la mano
          victoryStarted = true;
          
          // Animar levantamiento de mano
          const rightArm = robloxCharacter.children[4]; // Brazo derecho
          rightArm.rotation.z = -Math.PI / 2; // Levantar brazo
          
          // Mostrar secuencia de victoria despu√©s de 2 segundos
          setTimeout(() => {
            showVictorySequence();
          }, 2000);
        }
      }
      
      droneRenderer.render(droneScene, droneCamera);
      droneAnimationId = requestAnimationFrame(animate);
    }
    
    animate();
  }

  function showVictorySequence() {
    // Cambiar fondo a blanco y negro
    droneScene.background = new THREE.Color(0x000000);
    
    // Hacer todos los objetos en escala de grises
    droneScene.traverse((object) => {
      if (object.material) {
        object.material.color.setHex(0x808080);
      }
    });
    
    // Mostrar calavera
    victorySequence.style.display = 'flex';
    
    // Terminar intro despu√©s de 3 segundos
    setTimeout(() => {
      endIntro();
    }, 3000);
  }

  function endIntro() {
    state.introCompleted = true;
    if (droneAnimationId) {
      cancelAnimationFrame(droneAnimationId);
    }
    if (droneRenderer && droneRenderer.domElement) {
      droneView.removeChild(droneRenderer.domElement);
    }
    epicIntro.style.display = 'none';
    startScreen.style.display = 'flex';
  }

  // ----- SISTEMA DE TIEMPO Y CLIMA -----
  function updateTimeAndWeather() {
    const hour = Math.floor(timeSystem.currentTime);
    const minute = Math.floor((timeSystem.currentTime - hour) * 60);
    const timeString = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
    
    let timeIcon, timePeriod;
    if (hour >= 6 && hour < 12) {
      timeIcon = 'üåÖ';
      timePeriod = 'Ma√±ana';
    } else if (hour >= 12 && hour < 18) {
      timeIcon = '‚òÄÔ∏è';
      timePeriod = 'D√≠a';
    } else if (hour >= 18 && hour < 21) {
      timeIcon = 'üåÜ';
      timePeriod = 'Tarde';
    } else {
      timeIcon = 'üåô';
      timePeriod = 'Noche';
    }

    let weatherIcon, weatherText;
    switch(timeSystem.weather) {
      case 'rainy':
        weatherIcon = 'üåßÔ∏è';
        weatherText = 'Lluvioso';
        break;
      case 'cloudy':
        weatherIcon = '‚òÅÔ∏è';
        weatherText = 'Nublado';
        break;
      default:
        weatherIcon = '‚òÄÔ∏è';
        weatherText = 'Soleado';
    }

    document.getElementById('timeDisplay').textContent = `${timeIcon} ${timePeriod} - ${timeString}`;
    document.getElementById('weatherDisplay').textContent = `${weatherIcon} ${weatherText}`;
  }

  // ----- MANEJO DE PANELES M√ìVILES -----
  function showMobilePanel(title, content) {
    document.getElementById('panelTitle').textContent = title;
    document.getElementById('panelContent').innerHTML = content;
    mobilePanel.classList.add('open');
    state.currentPanel = title;
  }

  function closeMobilePanel() {
    mobilePanel.classList.remove('open');
    state.currentPanel = null;
  }

  function generateInventoryContent() {
    let content = '<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:15px;">';
    
    seedCatalog.forEach(seed => {
      const count = state.inventory[seed.id] || 0;
      content += `
        <div style="background:rgba(255,255,255,0.1);border-radius:8px;padding:15px;text-align:center;border:2px solid ${count > 0 ? '#00D924' : 'rgba(255,255,255,0.3)'}">
          <div style="font-size:30px;margin-bottom:8px;">${seed.name}</div>
          <div style="font-weight:bold;color:${count > 0 ? '#00D924' : '#ccc'}">${count}</div>
        </div>
      `;
    });
    
    content += '</div>';
    return content;
  }

  function generateStoreContent() {
    let content = '<div style="display:grid;grid-template-columns:1fr;gap:15px;">';
    
    seedCatalog.forEach(seed => {
      content += `
        <div style="background:rgba(255,255,255,0.1);border-radius:8px;padding:15px;display:flex;justify-content:space-between;align-items:center;">
          <div>
            <div style="font-size:18px;font-weight:bold;margin-bottom:5px;">${seed.name}</div>
            <div style="color:#ccc;font-size:14px;">${seed.desc}</div>
            <div style="color:#FFB800;font-weight:bold;margin-top:5px;">üí∞ ${seed.price} monedas</div>
          </div>
          <button onclick="buySeed('${seed.id}')" style="background:var(--primary);border:none;color:white;padding:10px 15px;border-radius:4px;cursor:pointer;">Comprar</button>
        </div>
      `;
    });
    
    content += '</div>';
    return content;
  }

  window.buySeed = function(seedId) {
    const seed = seedCatalog.find(s => s.id === seedId);
    if (!seed) return;
    
    if (state.money >= seed.price) {
      state.money -= seed.price;
      state.inventory[seedId] = (state.inventory[seedId] || 0) + 1;
      updateUI();
      showToast(`${seed.name} comprada exitosamente!`);
      
      // Actualizar contenido del panel si la tienda est√° abierta
      if (state.currentPanel === 'Tienda') {
        document.getElementById('panelContent').innerHTML = generateStoreContent();
      }
    } else {
      showToast('No tienes suficientes monedas!');
    }
  };

  // ----- CONTROLES M√ìVILES -----
  function setupMobileControls() {
    const joystick = document.getElementById('joystick');
    const knob = document.getElementById('joystickKnob');
    let joystickData = { x: 0, y: 0, active: false };
    
    // Joystick t√°ctil
    joystick.addEventListener('touchstart', (e) => {
      joystickData.active = true;
      e.preventDefault();
    });
    
    joystick.addEventListener('touchmove', (e) => {
      if (!joystickData.active) return;
      e.preventDefault();
      
      const touch = e.touches[0];
      const rect = joystick.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      
      let dx = touch.clientX - centerX;
      let dy = touch.clientY - centerY;
      
      const maxRadius = rect.width * 0.4;
      const distance = Math.hypot(dx, dy);
      
      if (distance > maxRadius) {
        dx = dx * maxRadius / distance;
        dy = dy * maxRadius / distance;
      }
      
      knob.style.transform = `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px))`;
      
      joystickData.x = dx / maxRadius;
      joystickData.y = dy / maxRadius;
    });
    
    joystick.addEventListener('touchend', () => {
      joystickData.active = false;
      joystickData.x = 0;
      joystickData.y = 0;
      knob.style.transform = 'translate(-50%, -50%)';
    });
    
    // Botones de acci√≥n
    document.getElementById('jumpBtn').addEventListener('click', () => {
      showToast('¬°Salto!');
    });
    
    document.getElementById('interactBtn').addEventListener('click', () => {
      showToast('¬°Interactuando!');
    });
  }

  // ----- INICIAR JUEGO -----
  function startGame() {
    startScreen.style.display = 'none';
    gameScreen.classList.add('active');
    state.gameStarted = true;
    
    setupMobileControls();
    updateUI();
    updateTimeAndWeather();
    
    showToast('¬°Bienvenido a Garden Dreams!');
  }

  function updateUI() {
    document.getElementById('money').textContent = state.money;
  }

  function showToast(message, duration = 3000) {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.style.display = 'block';
    
    setTimeout(() => {
      toast.style.display = 'none';
    }, duration);
  }

  // ----- EVENT LISTENERS -----
  document.getElementById('skipIntro').addEventListener('click', endIntro);
  document.getElementById('btnPlay').addEventListener('click', startGame);
  document.getElementById('btnOnline').addEventListener('click', () => {
    showToast('Multijugador pr√≥ximamente!');
  });
  document.getElementById('btnSettings').addEventListener('click', () => {
    showToast('Configuraci√≥n pr√≥ximamente!');
  });

  // HUD Controls
  document.getElementById('hamburgerBtn').addEventListener('click', () => {
    hamburgerMenu.classList.add('open');
  });
  
  document.getElementById('closeHamburger').addEventListener('click', () => {
    hamburgerMenu.classList.remove('open');
  });

  // Menu Items
  document.getElementById('showInventory').addEventListener('click', () => {
    hamburgerMenu.classList.remove('open');
    showMobilePanel('Inventario', generateInventoryContent());
  });
  
  document.getElementById('showStore').addEventListener('click', () => {
    hamburgerMenu.classList.remove('open');
    showMobilePanel('Tienda', generateStoreContent());
  });
  
  document.getElementById('showSettings').addEventListener('click', () => {
    hamburgerMenu.classList.remove('open');
    showToast('Configuraci√≥n pr√≥ximamente!');
  });
  
  document.getElementById('showMap').addEventListener('click', () => {
    hamburgerMenu.classList.remove('open');
    showToast('Mapa pr√≥ximamente!');
  });
  
  document.getElementById('exitGame').addEventListener('click', () => {
    hamburgerMenu.classList.remove('open');
    if (confirm('¬øSalir del juego?')) {
      startScreen.style.display = 'flex';
      gameScreen.classList.remove('active');
      state.gameStarted = false;
    }
  });

  document.getElementById('closeMobilePanel').addEventListener('click', closeMobilePanel);

  // Resize handler
  window.addEventListener('resize', () => {
    if (droneCamera && droneRenderer) {
      droneCamera.aspect = window.innerWidth / window.innerHeight;
      droneCamera.updateProjectionMatrix();
      droneRenderer.setSize(window.innerWidth, window.innerHeight);
    }
  });

  // ----- INICIALIZACI√ìN -----
  updateUI();
  createEpicIntro();

  // Simulador de cambios de tiempo cada 30 segundos
  setInterval(() => {
    if (state.gameStarted) {
      timeSystem.currentTime += 0.5;
      if (timeSystem.currentTime >= 24) timeSystem.currentTime = 0;
      
      // Cambiar clima aleatoriamente
      if (Math.random() < 0.3) {
        const weathers = ['sunny', 'rainy', 'cloudy'];
        timeSystem.weather = weathers[Math.floor(Math.random() * weathers.length)];
        timeSystem.isRaining = timeSystem.weather === 'rainy';
      }
      
      updateTimeAndWeather();
    }
  }, 30000);

  </script>
</body>
</html>
